<?phpclass customer extends MY_Controller{	public function __construct(){		parent::__construct();        $this->_data['now'] = 'Khách Hàng';        $this->load->model('mcustomer');        $user = $this->session->userdata('user');        if(!$user || $user['user_type'] != 'administrator'){            if($user && $user['user_type']!='nhanvien' && !strpos($_SERVER['REQUEST_URI'],'admin/product/phieubanhang') && !strpos($_SERVER['REQUEST_URI'],'admin/index/ajax')){                redirect(base_url()."admin/product/phieubanhang");                }            else if($user['user_type']=='administrator'){                redirect(base_url().'admin');            }               else if(!$user){                redirect(base_url().'admin/login');            }                        }        $this->form_validation->CI =& $this;	}	public function listall(){        if(!isset($_GET['per_page'])){            $start = 0 ;        }else{            $start=$_GET['per_page'];        }		$this->load->library('pagination');		$config['base_url'] = base_url().'/customer/listall?';		//config phân trang		$config['total_rows'] = $this->mcustomer->numRows();		$config['per_page'] =15;		$config['uri_segment'] = 4;		$config['cur_tag_open'] = "<li><a><font color='black'>";		$config['cur_tag_close'] = '</font></a></li>';		$config['num_tag_open'] = '<li>';		$config['num_tag_close'] = '</li>';		$config['prev_link'] = 'Prev';		$config['prev_tag_open'] = '<li>';		$config['prev_tag_close'] = '</li>';		$config['next_link'] = 'Next';		$config['next_tag_open'] = '<li>';		$config['next_tag_close'] = '</li>';		$config['first_tag_open'] = '<li>';		$config['first_tag_close'] = '</li>';		$config['last_tag_open'] = '<li>';		$config['last_tag_close'] = '</li>';		$this->pagination->initialize($config);		$this->_data['pagination']=$this->pagination->create_links();		$this->_data['template'] = '/customer/list_view';		$this->_data['title'] = 'Trang Quản Lý Danh Mục ';		$this->_data['info'] = $this->mcustomer->listAll($config['per_page'],$start);		$this->load->view("layout/admin",$this->_data);	}    public function search(){        if(!isset($_GET['per_page'])){            $start = 0 ;        }else{            $start=$_GET['per_page'];        }        if(!isset($_GET['name'])){            $name = '' ;        }else{            $name=$_GET['name'];        }        $this->_data['name'] = $name;        $this->load->library('pagination');        $config['base_url'] = base_url().'/customer/listall?name='.$name;        //config phân trang        $config['total_rows'] = $this->mcustomer->numRows($name);        $config['per_page'] =15;        $config['uri_segment'] = 4;        $config['cur_tag_open'] = "<li><a><font color='black'>";        $config['cur_tag_close'] = '</font></a></li>';        $config['num_tag_open'] = '<li>';        $config['num_tag_close'] = '</li>';        $config['prev_link'] = 'Prev';        $config['prev_tag_open'] = '<li>';        $config['prev_tag_close'] = '</li>';        $config['next_link'] = 'Next';        $config['next_tag_open'] = '<li>';        $config['next_tag_close'] = '</li>';        $config['first_tag_open'] = '<li>';        $config['first_tag_close'] = '</li>';        $config['last_tag_open'] = '<li>';        $config['last_tag_close'] = '</li>';        $this->pagination->initialize($config);        $this->_data['pagination']=$this->pagination->create_links();        $this->_data['template'] = '/customer/list_view';        $this->_data['title'] = 'Trang Quản Lý Danh Mục ';        $this->_data['info'] = $this->mcustomer->listAll($config['per_page'],$start,$name);        $this->load->view("layout/admin",$this->_data);    }	public function add(){        $this->_data['action'] = strtolower(__FUNCTION__);		if(isset($_POST['ok'])){            $this->form_validation->set_rules("code","Mã Khách Hàng","required|callback_check_code");            $this->form_validation->set_rules("name","Tên Khách Hàng","required|callback_check_name");            $this->form_validation->set_rules("address","Địa Chỉ","required");            $this->form_validation->set_rules("email","Email","required");            $this->form_validation->set_rules("phone","Điện Thoại","required");			if($this->form_validation->run()==TRUE){				$arr = array(                    'code' => trim($this->input->post('code')),                    'name' => trim($this->input->post('name')),					'address' => $this->input->post('address'),					'email' => $this->input->post('email'),					'phone' => $this->input->post('phone'),					'type' => $this->input->post('type'),					'created' =>time(),					'updated' =>time(),					);				$this->mcustomer->add($arr);				$this->session->set_flashdata('ses_flash',"Thêm");				redirect(base_url()."admin/customer/listall");			}		}		$this->_data['template'] = '/customer/modify_view';		$this->_data['title'] = 'Trang Thêm Thực Đơn ';		$this->load->view("layout/admin",$this->_data);	}	public function del($id){		$this->mcustomer->del($id);		$this->session->set_flashdata('ses_flash',"Xóa");		redirect(base_url()."admin/customer/listall");	}    public function dellist(){        foreach($_POST['del'] as $id){            $this->mcustomer->del($id);        }        $this->session->set_flashdata('ses_flash',"Xóa");        redirect(base_url()."/customer/listall");    }	public function edit($id){        $this->_data['action'] = strtolower(__FUNCTION__);		if(isset($_POST['ok'])){            $this->form_validation->set_rules("code","Mã Khách Hàng","required");            $this->form_validation->set_rules("name","Tên Khách Hàng","required ");            $this->form_validation->set_rules("address","Địa Chỉ","required");            $this->form_validation->set_rules("email","Email","required");            $this->form_validation->set_rules("phone","Điện Thoại","required");            if($this->form_validation->run()==TRUE){                $arr = array(                    'code' => trim($this->input->post('code')),                    'name' => trim($this->input->post('name')),                    'address' => $this->input->post('address'),                    'email' => $this->input->post('email'),                    'phone' => $this->input->post('phone'),                    'type' => $this->input->post('type'),                    'updated' =>time(),                );				$this->mcustomer->editById($id,$arr);				$this->session->set_flashdata('ses_flash',"Sửa");				redirect(base_url()."admin/customer/listall");			}		}		$this->_data['info'] = $this->mcustomer->getById($id);		$this->_data['template'] = '/customer/modify_view';		$this->_data['title'] = 'Trang Sửa User ';		$this->load->view("layout/admin",$this->_data);	}    public function check_name($name){        if($this->mcustomer->checkName(trim($name))==false){            $this->form_validation->set_message("check_name","Tên Khách Hàng đã được sử dụng .");            return false;        }else{            return true;        }    }    public function check_code($code){        if($this->mcustomer->checkCode(trim($code))==false){            $this->form_validation->set_message("check_code","Mã Khách Hàng đã được sử dụng .");            return false;        }else{            return true;        }    }    public function phieuthu($id){        if(!isset($_GET['per_page'])){            $start = 0 ;        }else{            $start=$_GET['per_page'];        }        $this->load->library('pagination');        $config['base_url'] = base_url().'/customer/phieuthu/'.$id.'?';        //config phân trang        $config['total_rows'] = $this->mcustomer->phieuthuRows($id);        $config['per_page'] =15;        $config['cur_tag_open'] = "<li><a><font color='black'>";        $config['cur_tag_close'] = '</font></a></li>';        $config['num_tag_open'] = '<li>';        $config['num_tag_close'] = '</li>';        $config['prev_link'] = 'Prev';        $config['prev_tag_open'] = '<li>';        $config['prev_tag_close'] = '</li>';        $config['next_link'] = 'Next';        $config['next_tag_open'] = '<li>';        $config['next_tag_close'] = '</li>';        $config['first_tag_open'] = '<li>';        $config['first_tag_close'] = '</li>';        $config['last_tag_open'] = '<li>';        $config['last_tag_close'] = '</li>';        $this->pagination->initialize($config);        $this->_data['pagination']=$this->pagination->create_links();        $this->_data['template'] = '/customer/phieuthu';        $this->_data['info'] = $this->mcustomer->phieuthu($id,$config['per_page'],$start);        $this->load->view("layout/admin",$this->_data);    }    public function phieuthudv($id){        if(!isset($_GET['per_page'])){            $start = 0 ;        }else{            $start=$_GET['per_page'];        }        $this->load->library('pagination');        $config['base_url'] = base_url().'/customer/phieuthudv/'.$id.'?';        //config phân trang        $config['total_rows'] = $this->mcustomer->phieuthudvRows($id);        $config['per_page'] =15;        $config['cur_tag_open'] = "<li><a><font color='black'>";        $config['cur_tag_close'] = '</font></a></li>';        $config['num_tag_open'] = '<li>';        $config['num_tag_close'] = '</li>';        $config['prev_link'] = 'Prev';        $config['prev_tag_open'] = '<li>';        $config['prev_tag_close'] = '</li>';        $config['next_link'] = 'Next';        $config['next_tag_open'] = '<li>';        $config['next_tag_close'] = '</li>';        $config['first_tag_open'] = '<li>';        $config['first_tag_close'] = '</li>';        $config['last_tag_open'] = '<li>';        $config['last_tag_close'] = '</li>';        $this->pagination->initialize($config);        $this->_data['pagination']=$this->pagination->create_links();        $this->_data['template'] = '/customer/phieuthudv';        $this->_data['info'] = $this->mcustomer->phieuthudv($id,$config['per_page'],$start);        $this->load->view("layout/admin",$this->_data);    }    public function phieuchi($id){        if(!isset($_GET['per_page'])){            $start = 0 ;        }else{            $start=$_GET['per_page'];        }        $this->load->library('pagination');        $config['base_url'] = base_url().'/customer/phieuchi/'.$id.'?';        //config phân trang        $config['total_rows'] = $this->mcustomer->phieuchiRows($id);        $config['per_page'] =15;        $config['cur_tag_open'] = "<li><a><font color='black'>";        $config['cur_tag_close'] = '</font></a></li>';        $config['num_tag_open'] = '<li>';        $config['num_tag_close'] = '</li>';        $config['prev_link'] = 'Prev';        $config['prev_tag_open'] = '<li>';        $config['prev_tag_close'] = '</li>';        $config['next_link'] = 'Next';        $config['next_tag_open'] = '<li>';        $config['next_tag_close'] = '</li>';        $config['first_tag_open'] = '<li>';        $config['first_tag_close'] = '</li>';        $config['last_tag_open'] = '<li>';        $config['last_tag_close'] = '</li>';        $this->pagination->initialize($config);        $this->_data['pagination']=$this->pagination->create_links();        $this->_data['template'] = '/customer/phieuchi';        $this->_data['info'] = $this->mcustomer->phieuchi($id,$config['per_page'],$start);        $this->load->view("layout/admin",$this->_data);    }    public function phieubanhang($id){        if(!isset($_GET['per_page'])){            $start = 0 ;        }else{            $start=$_GET['per_page'];        }        $this->load->library('pagination');        $config['base_url'] = base_url().'/customer/phieubanhang/'.$id.'?';        //config phân trang        $config['total_rows'] = $this->mcustomer->phieubanhangRows($id);        $config['per_page'] =15;        $config['cur_tag_open'] = "<li><a><font color='black'>";        $config['cur_tag_close'] = '</font></a></li>';        $config['num_tag_open'] = '<li>';        $config['num_tag_close'] = '</li>';        $config['prev_link'] = 'Prev';        $config['prev_tag_open'] = '<li>';        $config['prev_tag_close'] = '</li>';        $config['next_link'] = 'Next';        $config['next_tag_open'] = '<li>';        $config['next_tag_close'] = '</li>';        $config['first_tag_open'] = '<li>';        $config['first_tag_close'] = '</li>';        $config['last_tag_open'] = '<li>';        $config['last_tag_close'] = '</li>';        $this->pagination->initialize($config);        $this->_data['pagination']=$this->pagination->create_links();        $this->_data['template'] = '/customer/phieubanhang';        $this->_data['info'] = $this->mcustomer->phieubanhang($id,$config['per_page'],$start);        $this->load->view("layout/admin",$this->_data);    }    public function congno($id){        if(!isset($_GET['per_page'])){            $start = 0 ;        }else{            $start=$_GET['per_page'];        }        $this->load->library('pagination');        $config['base_url'] = base_url().'/customer/congno/'.$id.'?';        //config phân trang        $config['total_rows'] = $this->mcustomer->congnoRows($id);        $config['per_page'] =15;        $config['cur_tag_open'] = "<li><a><font color='black'>";        $config['cur_tag_close'] = '</font></a></li>';        $config['num_tag_open'] = '<li>';        $config['num_tag_close'] = '</li>';        $config['prev_link'] = 'Prev';        $config['prev_tag_open'] = '<li>';        $config['prev_tag_close'] = '</li>';        $config['next_link'] = 'Next';        $config['next_tag_open'] = '<li>';        $config['next_tag_close'] = '</li>';        $config['first_tag_open'] = '<li>';        $config['first_tag_close'] = '</li>';        $config['last_tag_open'] = '<li>';        $config['last_tag_close'] = '</li>';        $this->pagination->initialize($config);        $this->_data['pagination']=$this->pagination->create_links();        $this->_data['template'] = '/customer/congno';        $this->_data['info'] = $this->mcustomer->congno($id,$config['per_page'],$start);        $this->load->view("layout/admin",$this->_data);    }        public function add_ajax(){        $arr = array(            'code'=>$_POST['makhachhang'],            'name'=>$_POST['hoten'],            'address'=>$_POST['diachi'],            'phone'=>$_POST['dienthoai'],            'email'=>$_POST['email'],            'type'=>'Khách Hàng',            'created'=>time(),            'updated'=>time()        );        $id = $this->mcustomer->add($arr);        echo '<option value="'.$id.'">'.$_POST['hoten'].'</option>';    }}