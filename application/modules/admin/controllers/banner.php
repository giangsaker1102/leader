<?phpclass banner extends MY_Controller{	public function __construct(){		parent::__construct();        $this->_data['now'] = 'Slider';        $this->load->model('mbanner');        $this->load->model('mnews');        $this->load->model('mcategory');        $user = $this->session->userdata('user');        if(!$user || $user['user_type'] != 'administrator'){            if($user['user_type']!='nhanvien' || !strpos($_SERVER['REQUEST_URI'],'admin/product/phieubanhang')){                redirect(base_url()."admin/product/phieubanhang");                }                        }        $this->form_validation->CI =& $this;        //--------        //Lấy đường dẫn url của thư mục chứa hình ảnh được upload        $this->_gallery_url = base_url()."public/banner/";        //Lấy đường dẫn vật lý của thư mục chứa hình ảnh đươc upload        $this->_gallery_path = realpath(APPPATH. "../public/banner");	}	public function listall(){		$this->_data['template'] = 'admin/banner/list_view';		$this->_data['title'] = 'Trang Quản Lý Danh Mục ';		$this->_data['info'] = $this->mbanner->listAll();		$this->load->view("layout/admin",$this->_data);	}        public function add(){        $this->_data['action'] = strtolower(__FUNCTION__);		$this->form_validation->set_rules("link","Link","required");        if($this->form_validation->run()==TRUE){            $config = array('upload_path'   => $this->_gallery_path,                'allowed_types' => 'gif|jpg|png',                'max_size'      => '2000');            $this->load->library("upload",$config);            if(!$this->upload->do_upload("image")){                            }else{                $data =$this->upload->data();                $arr = array(                    'link' => $this->input->post('link'),                    'name' => $this->input->post('name'),                    'desc' => $this->input->post('desc'),                    'image' =>$data['file_name'],                    'position'=>$this->input->post('position'),                    'sort' =>  $this->input->post('sort')                );                if(count($this->mnews->getByLink($this->input->post('link')))!=0){                    $arr2 = array(                        'topnews' => $this->input->post('topnews'),                    );                    $this->mnews->editByLink($this->input->post('link'),$arr2);                    }                $this->mbanner->add($arr);                $this->session->set_flashdata('ses_flash',"Thêm");                redirect(base_url()."admin/banner/listall");            }        }		$this->_data['template'] = 'admin/banner/modify_view';        $this->_data['news'] = $this->mnews->getAll();		$this->_data['title'] = 'Trang Thêm Thực Đơn ';		$this->load->view("layout/admin",$this->_data);    }	public function edit($id){        $this->_data['action'] = strtolower(__FUNCTION__);		if(isset($_POST['ok'])){            $this->form_validation->set_rules("link","Link","required");            if($this->form_validation->run()==TRUE){                if($_FILES['image']['name']==""){                    $arr = array(                        'link' => $this->input->post('link'),                        'name' => $this->input->post('name'),                        'position'=>$this->input->post('position'),                        'desc' => $this->input->post('desc')                    );                    if(count($this->mnews->getByLink($this->input->post('link')))!=0){                        $arr2 = array(                            'topnews' => $this->input->post('topnews'),                        );                        $this->mnews->editByLink($this->input->post('link'),$arr2);                        }                    $this->mbanner->editById($id,$arr);                    $this->session->set_flashdata('ses_flash',"Sửa");                    redirect(base_url()."admin/banner/listall");                }else{                    //----------------                    $config = array('upload_path'   => $this->_gallery_path,                        'allowed_types' => 'gif|jpg|png',                        'max_size'      => '2000');                    $this->load->library("upload",$config);                    if(!$this->upload->do_upload("image")){                    }else{                        $data =$this->upload->data();                        $arr = array(                            'link' => $this->input->post('link'),                            'name' => $this->input->post('name'),                            'desc' => $this->input->post('desc'),                            'image' =>$data['file_name'],                            'position'=>$this->input->post('position'),                            'sort' =>  $this->input->post('sort')                        );                                                if(count($this->mnews->getByLink($this->input->post('link')))!=0){                            $arr2 = array(                                'topnews' => $this->input->post('topnews'),                            );                            $this->mnews->editByLink($this->input->post('link'),$arr2);                            }                        $this->mbanner->editById($id,$arr);                        $this->session->set_flashdata('ses_flash',"Sửa");                        redirect(base_url()."admin/banner/listall");                    }                }			}		}		$this->_data['info'] = $this->mbanner->getById($id);        $this->_data['category'] = $this->mcategory->getAll();		$this->_data['template'] = 'admin/banner/modify_view';		$this->_data['title'] = 'Trang Sửa User ';		$this->load->view("layout/admin",$this->_data);	}}