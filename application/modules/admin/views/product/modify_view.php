<script>    $(document).ready(function(){        $('#name').on('keyup change',function(){            var name = $('#name').val();            $.post( url + "admin/product/generateLink", { name : name})                .done(function(data ) {                    $('#link').val(data);                    $('#full-link').val(url+'chi-tiet/'+data+'.html');                });        })        $('#link').keyup(function(){            var link = $('#link').val();            $('#full-link').val(url+'chi-tiet/'+link+'.html');        })        $(".img-product").click(function(){            var avatar = $(this).attr('id');            var id = $('#id-hidden').val();            $.post( url + "admin/product/avatar", { avatar : avatar , id : id })            $(".img-product").removeClass('avatar');            $(this).addClass('avatar')        })        $(".img-attribute").click(function(){            var avatar = $(this).attr('id');            avatar = avatar.replace(/att/g,"");            var id = $('#id-hidden').val();            cha = $(this).parent().parent();            mausac = $(this).attr('title');            $.post( url + "admin/product/avatar_att", { avatar : avatar , id : id, name_link:mausac })            cha.parent().find(".img-attribute").removeClass('avatar');            $(this).addClass('avatar')        })    })</script><style>    .avatar{        border : 1px solid #0000ff !important;    }    .attr-pad{        margin-bottom: 10px;    }    .colorpicker-hidden{display: none;}    .colorpicker-visible{display: block!important;}</style><input type="hidden" id="id-hidden" value="<?php echo (isset($info['id']))?$info['id']:"" ?>"><div class="portlet box blue">    <div class="portlet-title">        <div class="caption">            <i class="fa fa-reorder"></i><?php echo  (isset($info))?"Sửa ":"Thêm " ?>Sản Phẩm        </div>        <div class="tools">            <a href="javascript:;" class="collapse">            </a>            <a href="javascript:;" class="reload">            </a>        </div>    </div>    <div class="portlet-body form">        <!-- BEGIN FORM-->        <form action='<?php echo base_url()?>admin/product/<?php echo $action ?>/<?php echo  (isset($info['id']))?$info['id']:"" ?>' class="form-horizontal" method="post" enctype="multipart/form-data" id="a">            <div class="form-body">                <?php if(validation_errors()!=''){ ?>                    <div class="note note-danger" >                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>                        <?php echo validation_errors() ?>                    </div>                <?php } ?>                <?php if(isset($error)&&$error=="upload"){                    echo "<div class='note note-danger'>";                    echo "<button type='button' class='close' data-dismiss='alert'>&times;</button>";                    echo "Upload ảnh chưa chính xác !!!";                    echo "   </div>";                } ?>                <div class="col-md-offset-2 col-md-10" style="margin-bottom: 20px ; margin-top: 20px">                    Ghi Chú : Những trường đánh dấu (*) là những trường bắt buộc .                </div>                <div class="form-group">					<label class="col-md-2 control-label">Danh Mục (*)</label>                    <div class="col-md-10">                    <?php foreach($listcate as $val){ ?>                                            <div class="checkbox-list col-md-4">							<label><input name="category_id[]" value="<?php echo $val->id ?>" <?php if(isset($info) && isset($info['multi_cate']) && $info['multi_cate']!=''){$multi = json_decode($info['multi_cate'],true); foreach($multi as $m){if($m==$val->id) echo 'checked';}} ?> type="checkbox" /><?php echo $val->name ?> </label>						</div>                                        <?php } ?>                    </div>                    				</div>                <div class="form-group">                    <label class="col-md-2 control-label">Tên Sản Phẩm (*)</label>                    <div class="col-md-4">                        <input type="text" id='name' required="required" name='name' placeholder="Tên Sản Phẩm ..." class='form-control' value='<?php                        echo (isset($info))?$info['name']:"" ?>'>                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Chất Liệu (*)</label>                    <div class="col-md-4">                        <select class="form-control" name="supplier_id">                            <?php foreach($supplier as $sup){ ?>                                <option value="<?php echo $sup['id'] ?>" <?php echo (isset($info)&&$info['supplier_id']==$sup['id'])?"selected":"" ?>><?php echo $sup['name'] ?></option>                            <?php } ?>                        </select>                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Đường Dẫn (*)</label>                    <div class="col-md-4">                        <input type="text" id='link' required="required" name='link' placeholder="Đường Dẫn ..." class='form-control' value='<?php                        echo (isset($info))?$info['link']:"" ?>'>                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Mã Sản Phẩm (*)</label>                    <div class="col-md-4">                        <input type="text" id='name' required="required" name='masp' placeholder="Mã Sản Phẩm ..." class='form-control' value='<?php                        echo (isset($info))?$info['masp']:"" ?>'>                    </div>                </div>                <!--<div class="form-group">                    <label class="col-md-2 control-label">Barcode (*)</label>                    <div class="col-md-4">                        <input type="text" id='name' name='barcode' placeholder="Barcode ..." class='form-control' value='<?php                        echo (isset($info))?$info['barcode']:"" ?>'>                    </div>                </div>-->                <div class="form-group">                    <label class="col-md-2 control-label">Key Word (*)</label>                    <div class="col-md-4">                        <input type="text" required="required" id='keyword' name='keyword' placeholder="Key Word ..." class='form-control' value='<?php                        echo (isset($info))?$info['keyword']:"" ?>'>                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Giá (*)</label>                    <div class="col-md-4">                        <input type="text" required="required" id='price' placeholder="Giá ..." class='form-control' value='<?php                        echo (isset($info))?number_format($info['price']):"" ?>'>                        <input type="hidden" name="price" id="price2" value='<?php echo (isset($info))?$info['price']:"" ?>'/>                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Giá Vốn (*)</label>                    <div class="col-md-4">                        <input type="text" required="required" id='price_von' placeholder="Giá Vốn..." class='form-control' value='<?php                        echo (isset($info))?number_format($info['giavon']):"" ?>'>                        <input type="hidden" name="giavon" id="price2_von" value='<?php echo (isset($info))?$info['giavon']:"" ?>'/>                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Số lượng (*)</label>                    <div class="col-md-4">                        <input type="text" required="required" name="all" placeholder="Số lượng ..." class='form-control' value='<?php                        echo (isset($info))?$info['all']:"" ?>' />                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Khuyến mãi (*)</label>                    <div class="col-md-4">                        <input type="text" required="required" id='price_reduce' name="price_reduce" placeholder="Khuyến mãi ..." class='form-control' value='<?php                        echo (isset($info))?number_format($info['price_reduce']):"" ?>' />                    </div>                    <label class="control-label">%</label>                </div>                <!-- custom attribute -->                <div class="form-group">                    <label class="col-md-2 control-label">Màu sắc (*)</label>                    <div class="col-md-10">                        <div id="focus_append">                            <?php if(isset($attribute1)){                                $s = 0;                                foreach($attribute1 as $val){                                    $s++;                                    ?>                                    <div class="row attr-pad">                                        <div class="col-md-4">                                            <div class="input-group" >                                                <input required="required" type="text"  name='attribute_old<?php echo $s ?>' value="<?php echo $val['name'] ?>"  class='form-control color-pick' />                                                <input type="hidden" value="<?php echo $val['id'] ?>" name="id_old<?php echo $s ?>" />                                            </div>                                        </div>                                        <div class="col-md-8">                                        <?php $image = json_decode($val['image'],true);                                            if(count($image)!=0)                                            for($i=0;$i<count($image);$i++){                                                if(isset($image[$i])){                                        ?>                                        <img id="<?php echo 'att'.$i ?>" title="<?php echo $val['name_link'] ?>" class="img-attribute <?php echo (isset($val)&&$val['avatar']==$i)?"avatar":"" ?>" src="<?php echo base_url().'public/product/'.$info['id'].'/attribute/'.$val['name_link'].'/thumbnail/'.$image[$i] ?>" style="max-height: 50px; border: 1px solid #CCC ; padding: 2px">                                        <?php } }?>                                        <a class="demo btn btn-primary"  href="<?php echo base_url() ?>admin/product/attribute/<?php echo $info['id'] ?>/<?php $this->load->helper('text'); $path = strtolower(url_title(removesign($val['name'],'dash',true))); echo $path ?>">Quản Lý</a>                                        <a class="demo btn btn-danger"  href="<?php echo base_url() ?>admin/product/del_attribute/<?php echo $info['id'] ?>/<?php echo $path ?>"><i class="fa fa-trash-o"></i></a>                                        </div>                                    </div>                                    <?php } }?>                            <div id="tocop" class="row attr-pad">                                <div class="col-md-11">                                    <div class="input-group">                                        <input class='form-control color-pick' required="required" type="text" name='attribute[]' value="#000000" />										<span class="input-group-btn">																					</span>                                        <input type="file" name="thuoctinh1[]" <?php if(!isset($attribute1) || $info['is_copy']=='true') echo 'required="required"'; ?> title="Hình Ảnh (850 x 1000)" class='form-control tt file-input'  data-filename-placement="inside" multiple>                                    </div>                                </div>                            </div>                        </div>                        <a id="add_attr" style="margin-top: 10px" class="btn btn-primary">Thêm</a>                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Thông Tin Sản Phẩm (*)</label>                    <div class="col-md-4">                        <textarea name="info" style="width: 100%;" required="required" rows="5" ><?php echo (isset($info))?$info['info']:""?></textarea>                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Thông Tin Chi Tiết (*)</label>                    <div class="col-md-10">                        <textarea name="description" class="ckeditor" ><?php echo (isset($info))?$info['description']:""?></textarea>                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Còn hàng </label>                    <div class="col-md-4">                        <input name="conhang" type="checkbox" value="on" <?php echo (isset($info) && $info['conhang']=='on')?"checked":""?> class="make-switch">                    </div>                </div>            </div>            <div class="form-actions nobg fluid">                <div class="col-md-offset-3 col-md-9">                    <a href="<?php if(isset($info) && isset($info['is_copy']) && $info['is_copy']=='true') echo base_url().'admin/product/del/'.$info['id']; else echo base_url().'admin/product/listall'; ?>"  class="btn default">Hủy bỏ</a>                    <button class="btn green" id='btn-ok' name='ok' type='submit'>Xác Nhận</button>                </div>            </div>            <input type="hidden" name="sl-attr" id="sl" value="<?php if(isset($attribute2)) echo count($attribute2)+1; else echo '1'; ?>" />        </form>        <!-- END FORM-->    </div></div><script>    $(document).ready(function(){        $('#add_attr').click(function(){            var html = $("#tocop").html();            $("#focus_append").append('<div class="row attr-pad">'+html+'</div> ');            $('.color-pick').colorpicker({                        format: 'hex'            });                        var k = 0;            $('input.tt').each(function(){                k++;                $(this).attr('name','thuoctinh'+k+'[]');            })        })                $('#add_attr2').click(function(){            var html = $("#tocop2").html();            $("#focus_append2").append('<div class="row attr-pad">'+html+'</div> ');                                    var k = 0;            $('input.ats').each(function(){                k++;                $(this).attr('name','attribute_sub'+k);            })            k = 0;            $('input.pr').each(function(){                k++;                $(this).attr('name','price'+k);            })            $('#sl').val(k);        })                        $('.color-pick').colorpicker({            format: 'hex'        });                        function formatNumber(number)        {            var number = number + '';            var x = number.split('.');            var x1 = x[0];            var x2 = x.length > 1 ? '.' + x[1] : '';            var rgx = /(\d+)(\d{3})/;            while (rgx.test(x1)) {                x1 = x1.replace(rgx, '$1' + ',' + '$2');            }            return x1 + x2;        }        $('#price').change(function(){            gia = $(this).val();            gia = gia.replace(/,/g ,'');            $('#price2').val(gia);            $(this).val(formatNumber(parseFloat(gia)));        })        $('#price_von').change(function(){            gia = $(this).val();            gia = gia.replace(/,/g ,'');            $('#price2_von').val(gia);            $(this).val(formatNumber(parseFloat(gia)));        })        $( "body" ).on( "mousemove", '.file-input-wrapper',function(cursor) {            var input, wrapper,                wrapperX, wrapperY,                inputWidth, inputHeight,                cursorX, cursorY;            // This wrapper element (the button surround this file input)            wrapper = $(this);            // The invisible file input element            input = wrapper.find("input");            // The left-most position of the wrapper            wrapperX = wrapper.offset().left;            // The top-most position of the wrapper            wrapperY = wrapper.offset().top;            // The with of the browsers input field            inputWidth= input.width();            // The height of the browsers input field            inputHeight= input.height();            //The position of the cursor in the wrapper            cursorX = cursor.pageX;            cursorY = cursor.pageY;            //The positions we are to move the invisible file input            // The 20 at the end is an arbitrary number of pixels that we can shift the input such that cursor is not pointing at the end of the Browse button but somewhere nearer the middle            moveInputX = cursorX - wrapperX - inputWidth + 20;            // Slides the invisible input Browse button to be positioned middle under the cursor            moveInputY = cursorY- wrapperY - (inputHeight/2);            // Apply the positioning styles to actually move the invisible file input            input.css({                left:moveInputX,                top:moveInputY            });        });    })    </script>